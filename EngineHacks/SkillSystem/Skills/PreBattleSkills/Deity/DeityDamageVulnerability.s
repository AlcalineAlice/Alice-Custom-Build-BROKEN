.thumb
.equ ItemTable, SkillTester+4
.equ DeityID, ItemTable+4

push {r4-r7, lr}
mov r4, r0 @atkr
mov r5, r1 @dfdr


@has skill
ldr r0, SkillTester
mov lr, r0
mov r0, r4 @attacker data
ldr r1, DeityID
.short 0xf800
cmp r0, #0
beq End

mov r3,#0x4A        @get the weapon ID and uses before battle byte
ldrb r2,[r4,r3]     @load the weapon ID for the attacker seperately by loading it as a byte instead of a short
mov r3,#0x24        @move the value that represents the length of the item struct into a register
mul r2,r3           @multiply both together to get the item's position in the item table
ldr r3,ItemTable    @load the item table
add r2,r3           @add both values together to obtain the exact location for the item in the table
mov r3,#0x1C        @get the weapon rank byte for attacker
ldrb r2,[r2,r3]     @load its value

cmp r2, #0          @check if the attacker's weapon rank is prf (0)
beq End             @branch to the end if so
cmp r0, #251        @now check if weapon is S rank
beq End             @if the attacker's weapon isn't S rank, branch to end
b   ApplyDamageReduction    @otherwise, apply damage reduction

ApplyDamageReduction:
mov r0,#0x5A        @get the attacker's attack
ldrh r1,[r4,r0]     @load its value
lsl r1,#1           @multiply by 2
strh r1,[r4,r0]     @store the final value
mov r0,#0x5C        @get the defender's defence
ldrh r1,[r5,r0]     @load its value
lsl r1,#1           @multiply by 2
strh r1,[r5,r0]     @store the final value

End:
pop {r4-r7, r15}

.align
.ltorg
SkillTester:
@Poin SkillTester
@WORD DeityID


/*
mov r1,#0x4A        @get the weapon ID and uses before battle byte
ldrb r0,[r5,r1]     @load the weapon ID for the defender seperately by loading it as a byte instead of a short
mov r1,#0x24        @move the value that represents the length of the item struct into a register
mul r0,r1           @multiply both together to get the item's position in the item table
ldr r1,ItemTable    @load the item table
add r0,r1           @add both values together to obtain the exact location for the item in the table
mov r1,#0x1C        @get the weapon rank byte for defender
ldrb r0,[r0,r1]     @load its value
*/